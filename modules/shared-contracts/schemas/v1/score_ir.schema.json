{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://transcriberator.dev/schemas/shared-contracts/v1/score_ir.schema.json",
  "title": "ScoreIR",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "irVersion",
    "scoreId",
    "globalMaps",
    "parts"
  ],
  "properties": {
    "irVersion": {
      "type": "string",
      "const": "v1"
    },
    "scoreId": {
      "type": "string",
      "format": "uuid"
    },
    "sourceJobId": {
      "type": "string",
      "format": "uuid"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 300
    },
    "globalMaps": {
      "$ref": "#/$defs/globalMaps"
    },
    "parts": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/part"
      }
    }
  },
  "$defs": {
    "globalMaps": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "timeSignatures",
        "tempoMap",
        "keySignatures"
      ],
      "properties": {
        "timeSignatures": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/timeSignatureEvent"
          }
        },
        "tempoMap": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/tempoEvent"
          }
        },
        "keySignatures": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/keySignatureEvent"
          }
        }
      }
    },
    "timeSignatureEvent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["measureIndex", "beats", "beatUnit"],
      "properties": {
        "measureIndex": {"type": "integer", "minimum": 0},
        "beats": {"type": "integer", "minimum": 1, "maximum": 32},
        "beatUnit": {"type": "integer", "enum": [1, 2, 4, 8, 16, 32]}
      }
    },
    "tempoEvent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["tick", "bpm"],
      "properties": {
        "tick": {"type": "integer", "minimum": 0},
        "bpm": {"type": "number", "exclusiveMinimum": 1}
      }
    },
    "keySignatureEvent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["measureIndex", "tonic", "mode"],
      "properties": {
        "measureIndex": {"type": "integer", "minimum": 0},
        "tonic": {
          "type": "string",
          "enum": ["C", "G", "D", "A", "E", "B", "F#", "C#", "F", "Bb", "Eb", "Ab", "Db", "Gb", "Cb"]
        },
        "mode": {"type": "string", "enum": ["major", "minor"]}
      }
    },
    "part": {
      "type": "object",
      "additionalProperties": false,
      "required": ["partId", "name", "measures"],
      "properties": {
        "partId": {"type": "string", "minLength": 1},
        "name": {"type": "string", "minLength": 1},
        "instrument": {"type": "string", "minLength": 1},
        "measures": {
          "type": "array",
          "minItems": 1,
          "items": {"$ref": "#/$defs/measure"}
        }
      }
    },
    "measure": {
      "type": "object",
      "additionalProperties": false,
      "required": ["measureIndex", "startTick", "durationTicks", "voices"],
      "properties": {
        "measureIndex": {"type": "integer", "minimum": 0},
        "startTick": {"type": "integer", "minimum": 0},
        "durationTicks": {"type": "integer", "minimum": 1},
        "voices": {
          "type": "array",
          "minItems": 1,
          "items": {"$ref": "#/$defs/voice"}
        }
      }
    },
    "voice": {
      "type": "object",
      "additionalProperties": false,
      "required": ["voiceId", "events"],
      "properties": {
        "voiceId": {"type": "string", "minLength": 1},
        "events": {
          "type": "array",
          "minItems": 1,
          "items": {"$ref": "#/$defs/event"}
        }
      }
    },
    "event": {
      "oneOf": [
        {"$ref": "#/$defs/noteEvent"},
        {"$ref": "#/$defs/restEvent"}
      ]
    },
    "noteEvent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "tick", "durationTicks", "pitchMidi", "velocity"],
      "properties": {
        "type": {"type": "string", "const": "note"},
        "tick": {"type": "integer", "minimum": 0},
        "durationTicks": {"type": "integer", "minimum": 1},
        "pitchMidi": {"type": "integer", "minimum": 0, "maximum": 127},
        "velocity": {"type": "integer", "minimum": 1, "maximum": 127},
        "tie": {"type": "string", "enum": ["start", "stop", "continue"]}
      }
    },
    "restEvent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "tick", "durationTicks"],
      "properties": {
        "type": {"type": "string", "const": "rest"},
        "tick": {"type": "integer", "minimum": 0},
        "durationTicks": {"type": "integer", "minimum": 1}
      }
    }
  }
}
